<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ø®Ø±Ù¾Ø§ Ùˆ ØªÛŒØ±Ú†Ù‡ Ø³Ù…Ø§ÙˆÛŒ â€” Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ</title>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap');
    
    :root {
      --brand:#1E6AA7;
      --dark:#0D1117;
      --panel:#0F141B;
      --text:#E6EEF7;
      --muted:#A7B9CC;
      --border:rgba(255,255,255,.10);
      --success:#10b981;
      --error:#ef4444;
      --warning:#f59e0b;
    }
    * { box-sizing:border-box; }
    body {
      margin:0;
      background:linear-gradient(180deg,#0D1117,#0B0F14);
      color:var(--text);
      font-family:'B Nazanin', 'Times New Roman', Times, serif;
      line-height:1.6;
    }
    .container {
      max-width:1100px;
      margin:28px auto;
      padding:16px;
    }
    .header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:12px;
      border-radius:14px;
      background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(30,106,167,.08));
      border:1px solid var(--border);
    }
    .logo {
      width:72px;
      height:72px;
      border-radius:12px;
      object-fit:cover;
      background:#000;
      border:1px solid rgba(255,255,255,.12);
    }
    .grid {
      display:grid;
      grid-template-columns:1.6fr 1fr;
      gap:14px;
      margin-top:16px;
    }
    @media(max-width:980px){
      .grid{ grid-template-columns:1fr; }
    }
    .card {
      background:linear-gradient(180deg,#0b0f14,#0f141b);
      border:1px solid var(--border);
      padding:14px;
      border-radius:12px;
    }
    label {
      display:block;
      font-size:12px;
      color:var(--muted);
      margin-bottom:6px;
    }
    .small {
      font-size:11px;
      margin-top:6px;
    }
    select, input[type=number], input[type=password], input[type=text] {
      width:100%;
      padding:11px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.06);
      outline:none;
      background:#F9FAFB;
      color:#111;
      font-size:13px;
      transition: all 0.2s ease;
    }
    select:focus, input[type=number]:focus, input[type=password]:focus, input[type=text]:focus {
      box-shadow:0 6px 20px rgba(30,106,167,.18);
      border-color:var(--brand);
    }
    select.invalid, input[type=number].invalid {
      border-color: var(--error);
      background-color: #fee;
    }
    select.valid, input[type=number].valid {
      border-color: var(--success);
    }
    select {
      appearance:none;
      -webkit-appearance:none;
      background-image:
        linear-gradient(45deg,transparent 50%, var(--brand) 50%),
        linear-gradient(135deg, var(--brand) 50%, transparent 50%);
      background-position:
        calc(100% - 18px) calc(1em + 2px),
        calc(100% - 13px) calc(1em + 2px);
      background-size:8px 8px,8px 8px;
      background-repeat:no-repeat;
    }
    select option {
      background:#fff;
      color:#111;
    }
    .btn {
      padding:10px 14px;
      border-radius:10px;
      border:none;
      background:linear-gradient(180deg,var(--brand),#0b3d63);
      color:#fff;
      cursor:pointer;
      font-size:13px;
      transition: all 0.2s ease;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(30, 106, 167, 0.3);
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    .btn.secondary {
      background:linear-gradient(180deg,#2b2f34,#1e2126);
    }
    .btn.success {
      background:linear-gradient(180deg,var(--success),#047857);
    }
    .btn.error {
      background:linear-gradient(180deg,var(--error),#b91c1c);
    }
    .result {
      margin-top:12px;
      padding:12px;
      border-radius:10px;
      background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(0,0,0,.12));
      display:flex;
      justify-content:space-between;
      align-items:center;
      border:1px solid var(--border);
    }
    .chip {
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.03);
      color:var(--muted);
      font-size:12px;
      margin:4px 6px;
      border:1px solid rgba(255,255,255,.06);
    }
    .chip.success {
      background: rgba(16, 185, 129, 0.15);
      color: #10b981;
      border-color: rgba(16, 185, 129, 0.3);
    }
    .chip.warning {
      background: rgba(245, 158, 11, 0.15);
      color: #f59e0b;
      border-color: rgba(245, 158, 11, 0.3);
    }
    .chip.info {
      background: rgba(30, 106, 167, 0.15);
      color: #1E6AA7;
      border-color: rgba(30, 106, 167, 0.3);
    }
    .chip.primary {
      background: rgba(139, 69, 19, 0.15);
      color: #8B4513;
      border-color: rgba(139, 69, 19, 0.3);
    }
    .admin-fab {
      position:fixed;
      left:16px;
      bottom:16px;
      padding:10px 12px;
      border-radius:12px;
      background:linear-gradient(180deg,#0f1519,#0b1114);
      border:1px solid var(--border);
      color:#cfe7ff;
      cursor:pointer;
      font-size:13px;
      z-index: 1000;
    }
    .modal-bg {
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.6);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:999;
    }
    .modal {
      width:min(680px,95vw);
      background:linear-gradient(180deg,#0b0f14,#0f141b);
      padding:14px;
      border-radius:12px;
      border:1px solid var(--border);
      max-height: 90vh;
      overflow-y: auto;
    }
    .footer {
      text-align:center;
      color:var(--muted);
      margin-top:18px;
      font-size:12px;
    }
    .table-preview {
      width:100%;
      border-collapse:collapse;
      font-size:12px;
      margin-top:8px;
    }
    .table-preview th, .table-preview td {
      border:1px solid rgba(255,255,255,.08);
      padding:4px 6px;
      text-align:center;
    }
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .validation-error {
      color: var(--error);
      font-size: 11px;
      margin-top: 4px;
      display: block;
    }
    .validation-success {
      color: var(--success);
      font-size: 11px;
      margin-top: 4px;
      display: block;
    }
    .tooltip {
      position: relative;
      display: inline-block;
    }
    .tooltip .tooltiptext {
      visibility: hidden;
      width: 200px;
      background-color: var(--panel);
      color: var(--text);
      text-align: center;
      border-radius: 6px;
      padding: 8px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -100px;
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 12px;
      border: 1px solid var(--border);
    }
    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
    .guide-section {
      background: rgba(255,255,255,.03);
      border-radius: 8px;
      padding: 10px;
      margin: 12px 0;
      border: 1px solid rgba(255,255,255,.06);
    }
    .guide-section h4 {
      margin: 0 0 8px 0;
      font-size: 13px;
      color: var(--brand);
    }
    .guide-section ul {
      margin: 0;
      padding-right: 16px;
    }
    .guide-section li {
      font-size: 12px;
      margin-bottom: 4px;
    }
    .status-message {
      padding: 8px 12px;
      border-radius: 8px;
      margin: 8px 0;
      font-size: 12px;
    }
    .status-message.success {
      background: rgba(16, 185, 129, 0.15);
      border: 1px solid rgba(16, 185, 129, 0.3);
      color: #10b981;
    }
    .status-message.error {
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #ef4444;
    }
    .status-message.info {
      background: rgba(30, 106, 167, 0.15);
      border: 1px solid rgba(30, 106, 167, 0.3);
      color: #1E6AA7;
    }
    .export-buttons {
      display: flex;
      gap: 10px;
      margin-top: 12px;
      flex-wrap: wrap;
    }
    .zigzag-labels {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <div style="display:flex;align-items:center;gap:12px">
      <img class="logo" id="logoImg" src="https://drive.google.com/thumbnail?id=1NNZcL2GPh8pzJd27WopQIUkNbqA6fI9T&sz=w1000" alt="logo"/>
      <div>
        <h2 style="margin:0">Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ø®Ø±Ù¾Ø§ Ùˆ ØªÛŒØ±Ú†Ù‡ Ø³Ù…Ø§ÙˆÛŒ</h2>
        <div style="color:var(--muted);font-size:12px">Ù†Ø³Ø®Ù‡ Ø¢ÙÙ„Ø§ÛŒÙ† â€” ÙˆÛŒÚ˜Ù‡ ÙØ±ÙˆØ´ Ùˆ Ù…Ø´Ø§ÙˆØ±Ù‡</div>
      </div>
    </div>
    <div style="text-align:left">
      <div style="font-weight:800">Û°Û¹Û°Û°ÛµÛµÛµÛ³Û±Û±Û³</div>
      <div style="color:var(--muted);font-size:12px">ÙˆØ§ØªØ³Ø§Ù¾ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±</div>
    </div>
  </div>

  <div class="guide-section">
    <h4>ğŸ“‹ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´Ø®ØµØ§Øª ÙÙ†ÛŒ</h4>
    <ul>
      <li>Ø§Ø±ØªÙØ§Ø¹ 20 Ø³Ø§Ù†ØªÛŒâ€ŒÙ…ØªØ±: Ù…Ù†Ø§Ø³Ø¨ Ø³Ù‚Ùâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§ Ø¯Ù‡Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ú©ÙˆØªØ§Ù‡â€ŒØªØ±</li>
      <li>Ø§Ø±ØªÙØ§Ø¹ 25 Ø³Ø§Ù†ØªÛŒâ€ŒÙ…ØªØ±: Ù…Ù†Ø§Ø³Ø¨ Ø³Ù‚Ùâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§ Ø¯Ù‡Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ù„Ù†Ø¯ØªØ±</li>
      <li>Ø²ÛŒÚ¯Ø²Ø§Ú¯ Ø¨Ø§ Ù‚Ø·Ø± Ú©Ù…ØªØ±: ÙˆØ²Ù† Ú©Ù…ØªØ± Ùˆ Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÛŒÙ†â€ŒØªØ±</li>
      <li>Ø²ÛŒÚ¯Ø²Ø§Ú¯ Ø¨Ø§ Ù‚Ø·Ø± Ø¨ÛŒØ´ØªØ±: Ù…Ù‚Ø§ÙˆÙ…Øª Ø¨ÛŒØ´ØªØ± Ùˆ Ù‚ÛŒÙ…Øª Ø¨Ø§Ù„Ø§ØªØ±</li>
    </ul>
  </div>

  <div class="grid">
    <div class="card">
      <h3 style="margin-top:0">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´Ø®ØµØ§Øª Ø®Ø±Ù¾Ø§ / ØªÛŒØ±Ú†Ù‡</h3>
      
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px">
        <div>
          <label>Ø§Ø±ØªÙØ§Ø¹ (Ø³Ø§Ù†ØªÛŒâ€ŒÙ…ØªØ±)</label>
          <select id="height"></select>
          <span id="heightError" class="validation-error"></span>
        </div>
        <div>
          <label>Ù‚Ø·Ø± Ø²ÛŒÚ¯Ø²Ø§Ú¯ (Ù…ÛŒÙ„ÛŒâ€ŒÙ…ØªØ±)</label>
          <select id="zigzag"></select>
          <span id="zigzagError" class="validation-error"></span>
          <div id="zigChips" class="zigzag-labels"></div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px">
        <div>
          <label>Ù…ÛŒÙ„Ú¯Ø±Ø¯ Ù¾Ø§ÛŒÛŒÙ† (Ù…ÛŒÙ„ÛŒâ€ŒÙ…ØªØ±)</label>
          <select id="bottom"></select>
          <span id="bottomError" class="validation-error"></span>
        </div>
        <div>
          <label>Ù…ÛŒÙ„Ú¯Ø±Ø¯ Ø¨Ø§Ù„Ø§ (Ù…ÛŒÙ„ÛŒâ€ŒÙ…ØªØ±)</label>
          <select id="top"></select>
          <span id="topError" class="validation-error"></span>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px">
        <div>
          <label>ØªÙ‚ÙˆÛŒØªÛŒ Û± (Ø³Ø§ÛŒØ²)</label>
          <select id="r1">
            <option value="0">â€”</option>
            <option>8</option><option>10</option><option>12</option>
            <option>14</option><option>16</option><option>18</option>
          </select>
          <label class="small">ØªØ¹Ø¯Ø§Ø¯</label>
          <input type="number" id="q1" min="0" value="0"/>
        </div>
        <div>
          <label>ØªÙ‚ÙˆÛŒØªÛŒ Û² (Ø³Ø§ÛŒØ²)</label>
          <select id="r2">
            <option value="0">â€”</option>
            <option>8</option><option>10</option><option>12</option>
            <option>14</option><option>16</option><option>18</option>
          </select>
          <label class="small">ØªØ¹Ø¯Ø§Ø¯</label>
          <input type="number" id="q2" min="0" value="0"/>
        </div>
        <div>
          <label>ØªÙ‚ÙˆÛŒØªÛŒ Û³ (Ø³Ø§ÛŒØ²)</label>
          <select id="r3">
            <option value="0">â€”</option>
            <option>8</option><option>10</option><option>12</option>
            <option>14</option><option>16</option><option>18</option>
          </select>
          <label class="small">ØªØ¹Ø¯Ø§Ø¯</label>
          <input type="number" id="q3" min="0" value="0"/>
        </div>
      </div>

      <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn" id="calcBtn">
          <span id="calcText">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ù‡Ø± Ù…ØªØ±</span>
          <span id="calcLoading" class="loading" style="display:none"></span>
        </button>
        <button class="btn secondary" id="previewBtn">Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§</button>
        <button class="btn secondary" id="resetBtn">Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ÙØ±Ù…</button>
      </div>

      <div class="result">
        <div>Ù‚ÛŒÙ…Øª Ù‡Ø± Ù…ØªØ± (ØªÙˆÙ…Ø§Ù†)</div>
        <strong id="pricePerM">â€”</strong>
      </div>
      
      <div id="calcStatus"></div>
    </div>

    <div class="card">
      <h3 style="margin-top:0">Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ ÙÙ†ÛŒ Ùˆ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</h3>
      <div id="preview" style="min-height:80px;border-radius:8px;border:1px dashed rgba(255,255,255,.08);padding:10px;background:linear-gradient(180deg,#01050a,transparent);font-size:12px"></div>
    </div>
  </div>
  
  <div class="card" style="margin-top:16px">
    <h3 style="margin-top:0">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´ØªØ±ÛŒ Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ±</h3>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px">
      <div>
        <label>Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ / Ø´Ø±Ú©Øª</label>
        <input type="text" id="clientName" placeholder="Ù†Ø§Ù… Ú©Ø§Ù…Ù„ Ù…Ø´ØªØ±ÛŒ ÛŒØ§ Ø´Ø±Ú©Øª">
      </div>
      <div>
        <label>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</label>
        <input type="text" id="clientPhone" placeholder="Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ù‡Ù…Ø±Ø§Ù‡ ÛŒØ§ Ø«Ø§Ø¨Øª">
      </div>
    </div>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px">
      <div>
        <label>Ø¢Ø¯Ø±Ø³ Ù¾Ø±ÙˆÚ˜Ù‡</label>
        <input type="text" id="clientAddress" placeholder="Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„ Ù…Ø­Ù„ Ù¾Ø±ÙˆÚ˜Ù‡">
      </div>
      <div>
        <label>Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
        <input type="text" id="projectName" placeholder="Ø¹Ù†ÙˆØ§Ù† Ù¾Ø±ÙˆÚ˜Ù‡">
      </div>
    </div>
  </div>
  
  <div class="card" style="margin-top:16px">
    <h3 style="margin-top:0">Ø¬Ø¯ÙˆÙ„ Ø§Ù‚Ù„Ø§Ù… Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ±</h3>

    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:8px">
      <div style="flex:1;min-width:120px">
        <label class="label">Ø·ÙˆÙ„ Ù‡Ø± ØªÛŒØ±Ú†Ù‡ (Ù…ØªØ±)</label>
        <input type="number" id="rowLength" min="0" step="0.01" value="0">
        <span id="lengthError" class="validation-error"></span>
      </div>
      <div style="flex:1;min-width:120px">
        <label class="label">ØªØ¹Ø¯Ø§Ø¯ ØªÛŒØ±Ú†Ù‡ (Ø¹Ø¯Ø¯)</label>
        <input type="number" id="rowQty" min="1" step="1" value="1">
        <span id="qtyError" class="validation-error"></span>
      </div>
    </div>

    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:8px">
      <button class="btn success" id="addToQuote">Ø§ÙØ²ÙˆØ¯Ù† Ø§ÛŒÙ† ØªØ±Ú©ÛŒØ¨ Ø¨Ù‡ Ø¬Ø¯ÙˆÙ„ Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ±</button>
      <button class="btn secondary" id="clearQuote">Ø­Ø°Ù Ù‡Ù…Ù‡ Ø³Ø·Ø±Ù‡Ø§</button>
    </div>

    <div style="overflow-x:auto">
      <table class="table-preview" id="quoteTable">
        <thead>
          <tr>
            <th>Ø±Ø¯ÛŒÙ</th>
            <th>Ø´Ø±Ø­</th>
            <th>Ø·ÙˆÙ„ Ù‡Ø± ØªÛŒØ±Ú†Ù‡ (Ù…ØªØ±)</th>
            <th>ØªØ¹Ø¯Ø§Ø¯</th>
            <th>Ø·ÙˆÙ„ Ú©Ù„ (Ù…ØªØ±)</th>
            <th>Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯(ØªÙˆÙ…Ø§Ù†)</th>
            <th>Ù…Ø¨Ù„Øº Ú©Ù„(ØªÙˆÙ…Ø§Ù†)</th>
            <th>Ø­Ø°Ù</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div style="margin-top:6px;font-size:12px;color:#d1d5db">
      <strong id="grandTotal">Û°</strong> ØªÙˆÙ…Ø§Ù†
    </div>

    <div class="export-buttons">
      <button class="btn success" id="exportImage">ğŸ–¼ï¸ Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ± Ø¨Ù‡ ØµÙˆØ±Øª Ø¹Ú©Ø³</button>
      <button class="btn success" id="sendWhatsapp" style="background:linear-gradient(180deg, #25D366, #128C7E)">
        ğŸ“± Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ± Ø§Ø² Ø·Ø±ÛŒÙ‚ ÙˆØ§ØªØ³Ø§Ù¾
      </button>
    </div>
  </div>

  <div class="footer">
    Ø·Ø±Ø§Ø­ÛŒ Ùˆ ØªÙˆØ³Ø¹Ù‡: Ù…Ø¬Ù…ÙˆØ¹Ù‡ ØªÙˆÙ„ÛŒØ¯ÛŒ Ø®Ø±Ù¾Ø§ Ùˆ ØªÛŒØ±Ú†Ù‡ Ø³Ù…Ø§ÙˆÛŒ â€” Ø±Ù†Ú¯ Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ: #2C2C2C Ùˆ #1E6AA7
  </div>
</div>

<!-- Ø¯Ú©Ù…Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø¯ÛŒØ± -->
<button class="admin-fab" id="openAdmin">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø¯ÛŒØ± ÙØ±ÙˆØ´</button>

<!-- Ù…ÙˆØ¯Ø§Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø¯ÛŒØ± -->
<div class="modal-bg" id="adminBg">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h4 style="margin:0">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø¯ÛŒØ± ÙØ±ÙˆØ´</h4>
      <button id="closeAdmin" class="btn secondary">Ø¨Ø³ØªÙ†</button>
    </div>
    <div style="height:1px;background:rgba(255,255,255,.06);margin:10px 0"></div>

    <label>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù…Ø¯ÛŒØ± (Ø¬Ù‡Øª Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ùˆ ÙˆÛŒØ±Ø§ÛŒØ´ Ø§Ø¹Ø¯Ø§Ø¯)</label>
    <input type="password" id="adminPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢"/>
    <span id="adminPassError" class="validation-error"></span>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px">
      <div>
        <label>Ù‚ÛŒÙ…Øª Ù‡Ø± Ú©ÛŒÙ„Ùˆ Ø¢Ù‡Ù† (ØªÙˆÙ…Ø§Ù†)</label>
        <input type="number" id="ironPrice" readonly placeholder="Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù…Ø®ÙÛŒ Ø§Ø³Øª"/>
      </div>
      <div>
        <label>Ù‡Ø²ÛŒÙ†Ù‡ Ø¨ØªÙ†â€ŒØ±ÛŒØ²ÛŒ Ù‡Ø± Ù…ØªØ± (ØªÙˆÙ…Ø§Ù†)</label>
        <input type="number" id="concretePrice" readonly placeholder="Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù…Ø®ÙÛŒ Ø§Ø³Øª"/>
      </div>
    </div>

    <div style="margin-top:10px">
      <label>Ù‚ÛŒÙ…Øª Ù‡Ø± Ù…ØªØ± ØªÙ‚ÙˆÛŒØªÛŒ (ØªÙˆÙ…Ø§Ù†)</label>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:6px">
        <input id="r8"  readonly placeholder="Ã˜8 (Ù…Ø®ÙÛŒ)"/>
        <input id="r10" readonly placeholder="Ã˜10 (Ù…Ø®ÙÛŒ)"/>
        <input id="r12" readonly placeholder="Ã˜12 (Ù…Ø®ÙÛŒ)"/>
        <input id="r14" readonly placeholder="Ã˜14 (Ù…Ø®ÙÛŒ)"/>
        <input id="r16" readonly placeholder="Ã˜16 (Ù…Ø®ÙÛŒ)"/>
        <input id="r18" readonly placeholder="Ã˜18 (Ù…Ø®ÙÛŒ)"/>
      </div>
    </div>

    <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
      <button id="unlockBtn" class="btn">Ù†Ù…Ø§ÛŒØ´ / ÙˆÛŒØ±Ø§ÛŒØ´ (Ø¨Ø§ Ø±Ù…Ø²)</button>
      <button id="adminSave" class="btn success">Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø³ØªÙ†</button>
      <button id="adminReset" class="btn error">Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø¨Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶</button>
    </div>
    <div style="margin-top:8px;color:var(--muted);font-size:12px">
      Ù…Ù‚Ø§Ø¯ÛŒØ± Ø¨Ù‡â€ŒØµÙˆØ±Øª Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒâ€ŒØ´Ø¯Ù‡ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø§ÛŒÙ† Ø³ÛŒØ³ØªÙ… Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ù…Ø´ØªØ±ÛŒ Ø¨Ù‡ Ø§ÛŒÙ† ØµÙØ­Ù‡ Ùˆ Ø§Ø¹Ø¯Ø§Ø¯ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±Ø¯.
    </div>
    <div id="adminStatus" style="margin-top:10px"></div>
  </div>
</div>

<script>
// Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡
const WEIGHTS = {
  "20": {
    "4": {
      "8":  {"8": 1.66},
      "10": {"10": 2.40, "8": 2.17},
      "12": {"12": 3.17, "10": 2.89},
      "14": {"14": 4.07, "12": 3.76, "10": 3.53},
      "16": {"14": 4.70, "12": 4.45, "10": 4.20}
    },
    "6": {
      "8":  {"8": 2.04},
      "10": {"10": 2.745, "8": 2.53},
      "12": {"12": 3.545, "10": 3.285},
      "14": {"14": 4.44, "10": 3.985, "12": 4.185},
      "16": {"16": 5.67, "10": 4.69, "12": 5.00, "14": 5.25}
    }
  },
  "25": {
    "4": {
      "8":  {"8": 1.90},
      "10": {"10": 2.57, "8": 2.34},
      "12": {"12": 3.31, "10": 3.03},
      "14": {"14": 4.21, "12": 3.90, "10": 3.67},
      "16": {"14": 4.85, "12": 4.59, "10": 4.34}
    },
    "4.5": {
      "8":  {"8": 1.97},
      "10": {"10": 2.64, "8": 2.41},
      "12": {"12": 3.41, "10": 3.31},
      "14": {"14": 4.31, "12": 4.00, "10": 3.77},
      "16": {"14": 4.95, "12": 4.69, "10": 4.44}
    },
    "5": {
      "8":  {"8": 2.06},
      "10": {"10": 2.75, "8": 2.690},
      "12": {"12": 4.00, "10": 3.50, "8": 3.12},
      "14": {"12": 4.42, "14": 4.80, "10": 4.00},
      "16": {"10": 4.95, "12": 4.82, "14": 5.43}
    },
    "6": {
      "8":  {"8": 2.59},
      "10": {"10": 3.03, "8": 2.92},
      "12": {"12": 3.99, "10": 3.78},
      "14": {"14": 4.97, "10": 4.41, "12": 4.74},
      "16": {"16": 6.20, "10": 5.17, "12": 5.28, "14": 5.78}
    }
  }
};

// Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§ÛŒ Ø²ÛŒÚ¯Ø²Ø§Ú¯
const ZIGZAG_LABELS = {
  "20": {
    "4": { label: "Ø¨Ø§Ø²Ø§Ø±ÛŒ Ùˆ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯", type: "success" },
    "6": { label: "Ù…Ù‡Ù†Ø¯Ø³ÛŒ Ùˆ Ø·Ø¨Ù‚ Ù†Ù‚Ø´Ù‡", type: "primary" }
  },
  "25": {
    "4": { label: "Ø¨Ø§Ø²Ø§Ø±ÛŒ Ùˆ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯", type: "success" },
    "4.5": { label: "Ù…ÛŒØ§Ù†â€ŒØ±Ø¯Ù‡ Ø³Ø¨Ú©", type: "info" },
    "5": { label: "Ù…ÛŒØ§Ù†â€ŒØ±Ø¯Ù‡ Ø³Ù†Ú¯ÛŒÙ†", type: "warning" },
    "6": { label: "Ù…Ù‡Ù†Ø¯Ø³ÛŒ Ùˆ Ø·Ø¨Ù‚ Ù†Ù‚Ø´Ù‡", type: "primary" }
  }
};

// Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
const DEFAULT_CONFIG = {
  ironPrice: 60000,
  concretePrice: 60000,
  rebar: {
    8:  24600,
    10: 34600,
    12: 47300,
    14: 63700,
    16: 82000,
    18: 110000
  }
};

// ØªØ§Ø¨Ø¹ ØªØ¨Ø¯ÛŒÙ„ Ø¹Ø¯Ø¯ Ø¨Ù‡ Ø­Ø±ÙˆÙ ÙØ§Ø±Ø³ÛŒ
function numberToWords(number) {
    if (number === 0) return 'ØµÙØ±';
    
    const units = ['', 'ÛŒÚ©', 'Ø¯Ùˆ', 'Ø³ÛŒ', 'Ú†Ù‡Ø§Ø±', 'Ù¾Ù†Ø¬', 'Ø´Ø´', 'Ù‡ÙØª', 'Ù‡Ø´Øª', 'Ù†Ù‡'];
    const teens = ['Ø¯Ù‡', 'ÛŒØ§Ø²Ø¯Ù‡', 'Ø¯ÙˆØ§Ø²Ø¯Ù‡', 'Ø³ÛŒØ²Ø¯Ù‡', 'Ú†Ù‡Ø§Ø±Ø¯Ù‡', 'Ù¾Ø§Ù†Ø²Ø¯Ù‡', 'Ø´Ø§Ù†Ø²Ø¯Ù‡', 'Ù‡ÙØ¯Ù‡', 'Ù‡Ø¬Ø¯Ù‡', 'Ù†ÙˆØ²Ø¯Ù‡'];
    const tens = ['', '', 'Ø¨ÛŒØ³Øª', 'Ø³ÛŒ', 'Ú†Ù‡Ù„', 'Ù¾Ù†Ø¬Ø§Ù‡', 'Ø´ØµØª', 'Ù‡ÙØªØ§Ø¯', 'Ù‡Ø´ØªØ§Ø¯', 'Ù†ÙˆØ¯'];
    const hundreds = ['', 'ØµØ¯', 'Ø¯ÙˆÛŒØ³Øª', 'Ø³ÛŒØµØ¯', 'Ú†Ù‡Ø§Ø±ØµØ¯', 'Ù¾Ø§Ù†ØµØ¯', 'Ø´Ø´ØµØ¯', 'Ù‡ÙØªØµØ¯', 'Ù‡Ø´ØªØµØ¯', 'Ù†Ù‡ØµØ¯'];
    
    function convertThreeDigit(num) {
        let result = '';
        const hundred = Math.floor(num / 100);
        const ten = Math.floor((num % 100) / 10);
        const unit = num % 10;
        
        if (hundred > 0) {
            result += hundreds[hundred] + ' Ùˆ ';
        }
        
        if (ten === 1) {
            result += teens[unit];
        } else {
            if (ten > 1) {
                result += tens[ten];
                if (unit > 0) result += ' Ùˆ ';
            }
            if (unit > 0 && ten !== 1) {
                result += units[unit];
            }
        }
        
        return result.trim();
    }
    
    let words = '';
    const billion = Math.floor(number / 1000000000);
    const million = Math.floor((number % 1000000000) / 1000000);
    const thousand = Math.floor((number % 1000000) / 1000);
    const remainder = number % 1000;
    
    if (billion > 0) {
        words += convertThreeDigit(billion) + ' Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯ Ùˆ ';
    }
    
    if (million > 0) {
        words += convertThreeDigit(million) + ' Ù…ÛŒÙ„ÛŒÙˆÙ† Ùˆ ';
    }
    
    if (thousand > 0) {
        words += convertThreeDigit(thousand) + ' Ù‡Ø²Ø§Ø± Ùˆ ';
    }
    
    if (remainder > 0) {
        words += convertThreeDigit(remainder);
    }
    
    // Ø­Ø°Ù " Ùˆ " Ø§Ø¶Ø§ÙÛŒ Ø§Ø² Ø§Ù†ØªÙ‡Ø§
    words = words.replace(/ Ùˆ $/, '');
    
    return words + ' ØªÙˆÙ…Ø§Ù†';
}

// ØªØ§Ø¨Ø¹ ØªÙˆÙ„ÛŒØ¯ Ú©Ø¯ ÙˆØ§Ø­Ø¯
function generateProductCode(base, extras) {
    let code = `SMT-${base.height}-${base.zigzag}-${base.bottom}-${base.top}`;
    
    if (extras && extras.length > 0) {
        extras.forEach(extra => {
            code += `-T${extra.size}x${extra.qty}`;
        });
    }
    
    return code;
}

// Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ
function getAdminPassword() {
  return localStorage.getItem("samaviAdminPass") || "634152";
}

function setAdminPassword(newPass) {
  localStorage.setItem("samaviAdminPass", newPass);
}

function loadConfig() {
  try {
    const raw = localStorage.getItem("samaviConfig");
    if (!raw) return structuredClone(DEFAULT_CONFIG);
    const decoded = atob(raw);
    const obj = JSON.parse(decoded);
    if (!obj.rebar) obj.rebar = structuredClone(DEFAULT_CONFIG.rebar);
    if (!obj.ironPrice) obj.ironPrice = DEFAULT_CONFIG.ironPrice;
    if (!obj.concretePrice) obj.concretePrice = DEFAULT_CONFIG.concretePrice;
    return obj;
  } catch(e) {
    console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª:", e);
    return structuredClone(DEFAULT_CONFIG);
  }
}

function saveConfig(cfg) {
  try {
    const raw = JSON.stringify(cfg);
    const enc = btoa(raw);
    localStorage.setItem("samaviConfig", enc);
    return true;
  } catch(e) {
    console.error("Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª:", e);
    return false;
  }
}

let config = loadConfig();
let lastPricePerMValue = null;
let rowCounter = 0;

// Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ global
const heightSel = document.getElementById("height");
const zigSel    = document.getElementById("zigzag");
const bottomSel = document.getElementById("bottom");
const topSel    = document.getElementById("top");
const pricePerMEl = document.getElementById("pricePerM");
const previewEl = document.getElementById("preview");

// Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±
const adminBg = document.getElementById("adminBg");
const openAdminBtn = document.getElementById("openAdmin");
const closeAdminBtn = document.getElementById("closeAdmin");
const adminPassInput = document.getElementById("adminPass");
const ironInput = document.getElementById("ironPrice");
const concreteInput = document.getElementById("concretePrice");
const r8Input  = document.getElementById("r8");
const r10Input = document.getElementById("r10");
const r12Input = document.getElementById("r12");
const r14Input = document.getElementById("r14");
const r16Input = document.getElementById("r16");
const r18Input = document.getElementById("r18");
const unlockBtn = document.getElementById("unlockBtn");
const adminSaveBtn = document.getElementById("adminSave");
const adminResetBtn = document.getElementById("adminReset");
const adminStatus = document.getElementById("adminStatus");

function showAdminStatus(message, type = "info") {
  adminStatus.innerHTML = `<div class="status-message ${type}">${message}</div>`;
}

function clearAdminStatus() {
  adminStatus.innerHTML = "";
}

function fillAdminFields(showValues) {
  if (showValues) {
    ironInput.value = config.ironPrice;
    concreteInput.value = config.concretePrice;
    r8Input.value  = config.rebar[8];
    r10Input.value = config.rebar[10];
    r12Input.value = config.rebar[12];
    r14Input.value = config.rebar[14];
    r16Input.value = config.rebar[16];
    r18Input.value = config.rebar[18];
  } else {
    ironInput.value = "";
    concreteInput.value = "";
    r8Input.value  = "";
    r10Input.value = "";
    r12Input.value = "";
    r14Input.value = "";
    r16Input.value = "";
    r18Input.value = "";
  }
}

function setAdminReadonly(state) {
  [ironInput, concreteInput, r8Input, r10Input, r12Input, r14Input, r16Input, r18Input]
    .forEach(inp => inp.readOnly = state);
}

// ØªÙˆØ§Ø¨Ø¹ Ù¾Ø± Ú©Ø±Ø¯Ù† selectÙ‡Ø§
function populateHeights() {
  heightSel.innerHTML = "<option value=''>Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯â€¦</option>";
  Object.keys(WEIGHTS).sort((a,b)=>Number(a)-Number(b)).forEach(h=>{
    const opt = document.createElement("option");
    opt.value = h;
    opt.textContent = h;
    heightSel.appendChild(opt);
  });
  zigSel.innerHTML = "<option value=''>â€”</option>";
  bottomSel.innerHTML = "<option value=''>â€”</option>";
  topSel.innerHTML = "<option value=''>â€”</option>";
}

function populateZigs() {
  const h = heightSel.value;
  zigSel.innerHTML = "<option value=''>Ø§Ù†ØªØ®Ø§Ø¨ Ø²ÛŒÚ¯Ø²Ø§Ú¯â€¦</option>";
  const chipsDiv = document.getElementById("zigChips");
  chipsDiv.innerHTML = "";
  
  if (!h || !WEIGHTS[h]) return;
  
  const zigs = Object.keys(WEIGHTS[h]).sort((a,b)=>Number(a)-Number(b));
  
  zigs.forEach(z=>{
    const opt = document.createElement("option");
    opt.value = z;
    opt.textContent = z;
    zigSel.appendChild(opt);
  });

  if (ZIGZAG_LABELS[h]) {
    Object.keys(ZIGZAG_LABELS[h]).forEach(zigValue => {
      const labelInfo = ZIGZAG_LABELS[h][zigValue];
      const span = document.createElement("span");
      span.className = `chip ${labelInfo.type}`;
      span.textContent = `Ø²ÛŒÚ¯Ø²Ø§Ú¯ ${zigValue} â†’ ${labelInfo.label}`;
      chipsDiv.appendChild(span);
    });
  }
}

function populateBottoms() {
  const h = heightSel.value;
  const z = zigSel.value;
  bottomSel.innerHTML = "<option value=''>Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÛŒÙ„Ú¯Ø±Ø¯ Ù¾Ø§ÛŒÛŒÙ†â€¦</option>";
  topSel.innerHTML = "<option value=''>â€”</option>";
  if (!h || !z || !WEIGHTS[h] || !WEIGHTS[h][z]) return;
  const bottoms = Object.keys(WEIGHTS[h][z]).sort((a,b)=>Number(a)-Number(b));
  bottoms.forEach(b=>{
    const opt = document.createElement("option");
    opt.value = b;
    opt.textContent = b;
    bottomSel.appendChild(opt);
  });
}

function populateTops() {
  const h = heightSel.value;
  const z = zigSel.value;
  const b = bottomSel.value;
  topSel.innerHTML = "<option value=''>Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÛŒÙ„Ú¯Ø±Ø¯ Ø¨Ø§Ù„Ø§â€¦</option>";
  if (!h || !z || !b || !WEIGHTS[h] || !WEIGHTS[h][z] || !WEIGHTS[h][z][b]) return;
  const tops = Object.keys(WEIGHTS[h][z][b]).sort((a,b)=>Number(a)-Number(b));
  tops.forEach(t=>{
    const opt = document.createElement("option");
    opt.value = t;
    opt.textContent = t;
    topSel.appendChild(opt);
  });
}

// ØªØ§Ø¨Ø¹ Ù…Ø­Ø§Ø³Ø¨Ù‡ ÙˆØ²Ù† Ù¾Ø§ÛŒÙ‡
function getBaseWeight() {
  const h = heightSel.value;
  const z = zigSel.value;
  const b = bottomSel.value;
  const t = topSel.value;
  if (!h || !z || !b || !t) {
    return null;
  }
  if (!WEIGHTS[h] || !WEIGHTS[h][z] || !WEIGHTS[h][z][b] || WEIGHTS[h][z][b][t] === undefined) {
    return null;
  }
  return {
    height: Number(h),
    zigzag: Number(z),
    bottom: Number(b),
    top: Number(t),
    weight: WEIGHTS[h][z][b][t]
  };
}

// ØªØ§Ø¨Ø¹ Ú¯Ø±ÙØªÙ† ØªÙ‚ÙˆÛŒØªÛŒâ€ŒÙ‡Ø§
function getRebarExtras() {
  const items = [];
  for (let i=1;i<=3;i++) {
    const size = parseInt(document.getElementById("r"+i).value || "0",10);
    const qty  = parseInt(document.getElementById("q"+i).value || "0",10);
    if (size>0 && qty>0) {
      const price = config.rebar[size] || 0;
      items.push({size,qty,price});
    }
  }
  return items;
}

// ØªØ§Ø¨Ø¹ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ø¨Ø§ Ø¯Ø±Ù†Ø¸Ø±Ú¯ÛŒØ±ÛŒ ØªÙ‚ÙˆÛŒØªÛŒâ€ŒÙ‡Ø§
function calcPrice() {
  try {
    const base = getBaseWeight();
    if (!base) {
      alert("Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… Ù…Ø´Ø®ØµØ§Øª Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯");
      return;
    }
    
    const ironPrice = Number(config.ironPrice) || DEFAULT_CONFIG.ironPrice;
    const concretePrice = Number(config.concretePrice) || DEFAULT_CONFIG.concretePrice;

    const steelCost = base.weight * ironPrice;
    
    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‡Ø²ÛŒÙ†Ù‡ ØªÙ‚ÙˆÛŒØªÛŒâ€ŒÙ‡Ø§
    let extraCost = 0;
    const extras = getRebarExtras();
    extras.forEach(e => {
      extraCost += e.qty * (config.rebar[e.size] || 0);
    });
    
    const totalPerM = steelCost + concretePrice + extraCost;
    
    pricePerMEl.textContent = Math.round(totalPerM).toLocaleString("fa-IR");
    
    // Ø¢Ù¾Ø¯ÛŒØª Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´
    let text = "";
    text += `Ø§Ø±ØªÙØ§Ø¹: ${base.height} Ø³Ø§Ù†ØªÛŒâ€ŒÙ…ØªØ±<br>`;
    text += `Ù‚Ø·Ø± Ø²ÛŒÚ¯Ø²Ø§Ú¯: ${base.zigzag} Ù…ÛŒÙ„ÛŒâ€ŒÙ…ØªØ±<br>`;
    text += `Ù…ÛŒÙ„Ú¯Ø±Ø¯ Ù¾Ø§ÛŒÛŒÙ†: Ø¯Ùˆ Ø¹Ø¯Ø¯ ${base.bottom} Ù…ÛŒÙ„ÛŒâ€ŒÙ…ØªØ±<br>`;
    text += `Ù…ÛŒÙ„Ú¯Ø±Ø¯ Ø¨Ø§Ù„Ø§: ÛŒÚ© Ø¹Ø¯Ø¯ ${base.top} Ù…ÛŒÙ„ÛŒâ€ŒÙ…ØªØ±<br>`;
    text += `ÙˆØ²Ù† Ù‡Ø± Ù…ØªØ±: ${base.weight.toFixed(3)} Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…<br>`;
    
    if (extras.length > 0) {
      text += `ØªÙ‚ÙˆÛŒØªÛŒâ€ŒÙ‡Ø§: `;
      extras.forEach(e => {
        text += `${e.qty} Ø¹Ø¯Ø¯ Ã˜${e.size} `;
      });
      text += `<br>`;
    }
    
    text += `Ù‚ÛŒÙ…Øª Ù‡Ø± Ù…ØªØ±: ${Math.round(totalPerM).toLocaleString("fa-IR")} ØªÙˆÙ…Ø§Ù†<br>`;
    
    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ø¯ ÙˆØ§Ø­Ø¯ Ø¨Ù‡ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´
    const productCode = generateProductCode(base, extras);
    text += `<br><strong>Ú©Ø¯ ÙˆØ§Ø­Ø¯: ${productCode}</strong>`;
    
    previewEl.innerHTML = text;
    
    // Ø°Ø®ÛŒØ±Ù‡ Ù‚ÛŒÙ…Øª Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ±
    lastPricePerMValue = Math.round(totalPerM);
    
  } catch (error) {
    console.error("Ø®Ø·Ø§ Ø¯Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª:", error);
    alert("Ø®Ø·Ø§ Ø¯Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª");
  }
}

// ØªÙˆØ§Ø¨Ø¹ Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ±
function addToQuote() {
  const base = getBaseWeight();
  if (!base) {
    alert("Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ù…Ø´Ø®ØµØ§Øª Ø®Ø±Ù¾Ø§ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ùˆ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©Ù†ÛŒØ¯.");
    return;
  }

  if (lastPricePerMValue === null) {
    alert("Ø§Ø¨ØªØ¯Ø§ Ø±ÙˆÛŒ Â«Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ù‡Ø± Ù…ØªØ±Â» Ø¨Ø²Ù†ÛŒØ¯.");
    return;
  }

  const length = Number(document.getElementById("rowLength").value || "0");
  const qty    = Number(document.getElementById("rowQty").value || "0");
  const tbody = document.querySelector("#quoteTable tbody");

  if (!length || length <= 0) {
    alert("Ø·ÙˆÙ„ Ù‡Ø± ØªÛŒØ±Ú†Ù‡ Ø¨Ø§ÛŒØ¯ Ø¨Ø²Ø±Ú¯ØªØ± Ø§Ø² ØµÙØ± Ø¨Ø§Ø´Ø¯");
    return;
  }

  if (!qty || qty <= 0) {
    alert("ØªØ¹Ø¯Ø§Ø¯ ØªÛŒØ±Ú†Ù‡ Ø¨Ø§ÛŒØ¯ Ø¨Ø²Ø±Ú¯ØªØ± Ø§Ø² ØµÙØ± Ø¨Ø§Ø´Ø¯");
    return;
  }

  const totalLength = length * qty;
  const lineTotal   = totalLength * lastPricePerMValue;

  const tr = document.createElement("tr");
  tr.setAttribute("data-total", String(lineTotal));

  const extras = getRebarExtras();
  const productCode = generateProductCode(base, extras);
  
  const desc = `ØªÛŒØ±Ú†Ù‡ Ø§Ø±ØªÙØ§Ø¹ ${base.height}ØŒ Ø²ÛŒÚ¯Ø²Ø§Ú¯ ${base.zigzag}ØŒ Ù¾Ø§ÛŒÛŒÙ† Û²Ã—${base.bottom}ØŒ Ø¨Ø§Ù„Ø§ Û±Ã—${base.top}`;

  let extrasTxt = "";
  if (extras.length) {
    extrasTxt = extras.map(e => `${e.qty}Ã—Ã˜${e.size}`).join(" ØŒ ");
  }

  rowCounter += 1;

  tr.innerHTML = `
    <td>${rowCounter}</td>
    <td>${desc}${extrasTxt ? "<br><span style='font-size:11px;color:#9ca3af'>ØªÙ‚ÙˆÛŒØªÛŒ: " + extrasTxt + "</span>" : ""}<br><span style='font-size:10px;color:#1E6AA7'>Ú©Ø¯: ${productCode}</span></td>
    <td>${length}</td>
    <td>${qty}</td>
    <td>${totalLength.toFixed(2)}</td>
    <td>${lastPricePerMValue.toLocaleString("fa-IR")}</td>
    <td>${lineTotal.toLocaleString("fa-IR")}</td>
    <td><button class="btn error" style="padding:2px 6px;font-size:10px">Ø­Ø°Ù</button></td>
  `;

  const delBtn = tr.querySelector("button");
  delBtn.addEventListener("click", function(){
    if (confirm("Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø±Ø¯ÛŒÙ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ")) {
      tr.remove();
      refreshGrandTotal();
    }
  });

  tbody.appendChild(tr);
  refreshGrandTotal();
  
  document.getElementById("rowLength").value = "0";
  document.getElementById("rowQty").value = "1";
  
  alert("Ø±Ø¯ÛŒÙ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ± Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯");
}

function refreshGrandTotal() {
  const tbody = document.querySelector("#quoteTable tbody");
  const grandTotalEl = document.getElementById("grandTotal");
  
  let sum = 0;
  tbody.querySelectorAll("tr").forEach(tr => {
    const val = Number(tr.getAttribute("data-total") || "0");
    sum += val;
  });
  grandTotalEl.textContent = sum ? sum.toLocaleString("fa-IR") : "Û°";
}

function clearQuote() {
  const tbody = document.querySelector("#quoteTable tbody");
  
  if (tbody.querySelectorAll("tr").length === 0) {
    alert("Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ± Ø®Ø§Ù„ÛŒ Ø§Ø³Øª");
    return;
  }
  
  if (confirm("Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù ØªÙ…Ø§Ù…ÛŒ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ± Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ")) {
    tbody.innerHTML = "";
    rowCounter = 0;
    refreshGrandTotal();
    alert("ØªÙ…Ø§Ù… Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ± Ø­Ø°Ù Ø´Ø¯Ù†Ø¯");
  }
}

// ØªØ§Ø¨Ø¹ Ø®Ø±ÙˆØ¬ÛŒ Ø¹Ú©Ø³ - Ù†Ø³Ø®Ù‡ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ù†Ù‡Ø§ÛŒÛŒ
function exportToImage() {
  const exportDiv = document.createElement('div');
  exportDiv.style.cssText = `
    background: white;
    color: black;
    padding: 25px;
    font-family: 'B Nazanin', 'Times New Roman', Times, serif;
    direction: rtl;
    width: 800px;
    position: fixed;
    left: -10000px;
    top: 0;
    line-height: 1.6;
  `;
  
  const now = new Date();
  const persianDate = now.toLocaleDateString('fa-IR');
  
  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¬Ù…Ø¹ Ú©Ù„ ÙˆØ§Ù‚Ø¹ÛŒ
  let grandTotal = 0;
  const tbody = document.querySelector("#quoteTable tbody");
  const rows = tbody.querySelectorAll("tr");
  
  // Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÙˆÙ„ Ùˆ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¬Ù…Ø¹
  let tableRowsHTML = '';
  
  if (rows.length === 0) {
    tableRowsHTML = `
      <tr>
        <td colspan="7" style="text-align: center; padding: 20px; color: #666;">
          Ù‡ÛŒÚ† Ø¢ÛŒØªÙ…ÛŒ Ø¯Ø± Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯
        </td>
      </tr>
    `;
  } else {
    rows.forEach((row, index) => {
      const cells = row.querySelectorAll("td");
      
      // Ø®ÙˆØ§Ù†Ø¯Ù† Ù…Ù‚Ø§Ø¯ÛŒØ± Ø§Ø² Ø³Ù„ÙˆÙ„â€ŒÙ‡Ø§
      const length = cells[2]?.textContent || '0';
      const quantity = cells[3]?.textContent || '0';
      const unitPrice = cells[5]?.textContent || '0';
      const totalPrice = cells[6]?.textContent || '0';
      
      // ØªØ¨Ø¯ÛŒÙ„ Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡
      const totalPriceNumber = parseInt(totalPrice.replace(/[Ù¬,]/g, '').replace(/[Û°-Û¹]/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'.indexOf(d))) || 0;
      grandTotal += totalPriceNumber;
      
      // Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø¯ÛŒÙ Ø¬Ø¯ÙˆÙ„
      tableRowsHTML += `
        <tr>
          <td>${index + 1}</td>
          <td style="text-align: right; padding: 8px;">${cells[1]?.innerHTML || ''}</td>
          <td>${length}</td>
          <td>${quantity}</td>
          <td>${cells[4]?.textContent || '0'}</td>
          <td>${unitPrice}</td>
          <td>${totalPrice}</td>
        </tr>
      `;
    });
  }
  
  // HTML Ù†Ù‡Ø§ÛŒÛŒ
  const htmlContent = `
    <div style="text-align: center; border-bottom: 3px solid #1E6AA7; padding-bottom: 20px; margin-bottom: 25px;">
      <h1 style="margin: 0 0 15px 0; color: #1E6AA7; font-size: 24px; font-family: 'B Nazanin';">Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ± ØªÙˆÙ„ÛŒØ¯ÛŒ Ø®Ø±Ù¾Ø§ Ùˆ ØªÛŒØ±Ú†Ù‡ Ø³Ù…Ø§ÙˆÛŒ</h1>
      <div style="font-size: 16px; margin: 8px 0; font-family: 'B Nazanin'; white-space: nowrap; word-break: keep-all;">
        Ø¨Ù†Ø¯Ø±Ø¹Ø¨Ø§Ø³ Ø¨Ù„ÙˆØ§Ø± Ø§Ù…Ø§Ù… Ø®Ù…ÛŒÙ†ÛŒ-Ø´Ù‡Ø± Ù†Ù…Ø§ÛŒØ´-Ù…Ø¬ØªÙ…Ø¹ Ø¨Ø²Ø±Ú¯ Ø´Ù‡Ø± Ù†Ù…Ø§ÛŒØ´-Ø·Ø¨Ù‚Ù‡ Ø§ÙˆÙ„-ÙˆØ§Ø­Ø¯ Ø´Ù…Ø§Ø±Ù‡ Û±Û±
      </div>
      <div style="font-size: 14px; color: #555;">ØªÙ„ÙÙ†: Û°Û¹Û°Û°ÛµÛµÛµÛ³Û±Û±Û³</div>
    </div>
    
    <div style="display: flex; justify-content: space-between; margin-bottom: 25px; font-size: 14px; background: #f8f9fa; padding: 15px; border-radius: 8px;">
      <div><strong>ØªØ§Ø±ÛŒØ®:</strong> ${persianDate}</div>
      <div><strong>Ø´Ù…Ø§Ø±Ù‡ Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ±:</strong> PF-${Date.now().toString().slice(-6)}</div>
    </div>
    
    <div style="background: #f0f7ff; padding: 20px; border-radius: 8px; margin-bottom: 25px; border-right: 4px solid #1E6AA7;">
      <h3 style="margin: 0 0 15px 0; color: #1E6AA7; font-size: 18px;">Ù…Ø´Ø®ØµØ§Øª Ø®Ø±ÛŒØ¯Ø§Ø±</h3>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 14px;">
        <div><strong>Ù†Ø§Ù…:</strong> ${document.getElementById('clientName').value || 'Ù…Ø´ØªØ±ÛŒ Ù…Ø­ØªØ±Ù…'}</div>
        <div><strong>ØªÙ„ÙÙ†:</strong> ${document.getElementById('clientPhone').value || '---'}</div>
        <div style="grid-column: 1 / span 2;"><strong>Ø¢Ø¯Ø±Ø³:</strong> ${document.getElementById('clientAddress').value || '---'}</div>
      </div>
    </div>
    
    <table border="1" cellpadding="10" cellspacing="0" style="width: 100%; border-collapse: collapse; font-size: 13px; margin-bottom: 25px; font-family: 'B Nazanin';">
      <thead>
        <tr style="background: #1E6AA7; color: white;">
          <th width="5%" style="padding: 12px;">Ø±Ø¯ÛŒÙ</th>
          <th width="35%" style="padding: 12px;">Ø´Ø±Ø­ Ú©Ø§Ù„Ø§</th>
          <th width="10%" style="padding: 12px;">Ø·ÙˆÙ„ (Ù…ØªØ±)</th>
          <th width="10%" style="padding: 12px;">ØªØ¹Ø¯Ø§Ø¯</th>
          <th width="10%" style="padding: 12px;">Ø·ÙˆÙ„ Ú©Ù„ (Ù…ØªØ±)</th>
          <th width="15%" style="padding: 12px;">Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯(ØªÙˆÙ…Ø§Ù†)</th>
          <th width="15%" style="padding: 12px;">Ù…Ø¨Ù„Øº Ú©Ù„(ØªÙˆÙ…Ø§Ù†)</th>
        </tr>
      </thead>
      <tbody>
        ${tableRowsHTML}
      </tbody>
    </table>
    
    ${rows.length > 0 ? `
      <div style="text-align: left; font-size: 18px; font-weight: bold; margin: 25px 0; padding: 15px; background: linear-gradient(135deg, #1E6AA7, #2C5282); color: white; border-radius: 8px; border: 2px solid #1E6AA7;">
        <div>Ø¬Ù…Ø¹ Ú©Ù„: ${grandTotal.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</div>
        <div style="font-size: 16px; margin-top: 10px; text-align: center;">
          (${numberToWords(grandTotal)})
        </div>
      </div>
    ` : ''}
    
    <div style="border-top: 2px dashed #1E6AA7; padding-top: 20px; font-size: 12px; color: #555; background: #fafafa; padding: 15px; border-radius: 5px;">
      <strong style="color: #1E6AA7; font-size: 14px;">Ø´Ø±Ø§ÛŒØ· Ùˆ Ø¶ÙˆØ§Ø¨Ø·:</strong><br><br>
      â€¢ ÙˆØ§Ø­Ø¯ Ù‚ÛŒÙ…Øª ØªÙˆÙ…Ø§Ù† Ù…ÛŒØ¨Ø§Ø´Ø¯<br>
      â€¢ Ù…Ø³Ø¦ÙˆÙ„ÛŒØª Ø¨Ø±Ø±Ø³ÛŒ Ùˆ Ø§Ù†Ø·Ø¨Ø§Ù‚ Ø·ÙˆÙ„ Ùˆ ØªØ¹Ø¯Ø§Ø¯ Ùˆ Ù…Ø´Ø®ØµØ§Øª Ù¾ÛŒØ´ ÙØ§Ú©ØªÙˆØ± Ø¨Ø§ Ù†Ù‚Ø´Ù‡ Ù‡Ø§ÛŒ Ø³Ø§Ø²Ù‡ Ø¨Ø± Ø¹Ù‡Ø¯Ù‡ Ø®Ø±ÛŒØ¯Ø§Ø± Ù…ÛŒØ¨Ø§Ø´Ø¯<br>
      â€¢ ÙØ±ÙˆØ´Ù†Ø¯Ù‡ Ù…Ù„Ø²Ù… Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯ Ú†Ù†Ø§Ù†Ú†Ù‡ ØªÛŒØ±Ú†Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ­ÙˆÛŒÙ„ÛŒ Ù…ØºØ§ÛŒØ±Øª Ø¨Ø§ Ù…Ø´Ø®ØµØ§Øª ÙØ§Ú©ØªÙˆØ± Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ Ù†Ø³Ø¨Øª Ø¨Ù‡ Ø¹ÙˆØ¯Øª Ø¢Ù† Ù…Ø³ÙˆÙ„ Ø¨Ø§Ø´Ø¯<br>
      â€¢ Ø§Ø¹ØªØ¨Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ±: Û²Û´ Ø³Ø§Ø¹Øª
    </div>
  `;
  
  exportDiv.innerHTML = htmlContent;
  document.body.appendChild(exportDiv);
  
  html2canvas(exportDiv, {
    scale: 2,
    logging: false,
    useCORS: true,
    backgroundColor: "#ffffff"
  }).then(canvas => {
    const link = document.createElement('a');
    link.download = 'Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ±-Ø³Ù…Ø§ÙˆÛŒ-' + persianDate.replace(/\//g, '-') + '.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
    document.body.removeChild(exportDiv);
  });
}

// ØªØ§Ø¨Ø¹ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ± Ø§Ø² Ø·Ø±ÛŒÙ‚ ÙˆØ§ØªØ³Ø§Ù¾ (Ù†Ø³Ø®Ù‡ Ù…ØªÙ†ÛŒ)
function sendInvoiceViaWhatsapp() {
  const tbody = document.querySelector("#quoteTable tbody");
  const rows = tbody.querySelectorAll("tr");
  
  if (rows.length === 0) {
    alert("Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ± Ø®Ø§Ù„ÛŒ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø§Ù‚Ù„Ø§Ù…ÛŒ Ø¨Ù‡ Ø¬Ø¯ÙˆÙ„ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯.");
    return;
  }
  
  // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´ØªØ±ÛŒ
  const clientName = document.getElementById('clientName').value || 'Ù…Ø´ØªØ±ÛŒ Ù…Ø­ØªØ±Ù…';
  const clientPhone = document.getElementById('clientPhone').value || '---';
  const clientAddress = document.getElementById('clientAddress').value || '---';
  const projectName = document.getElementById('projectName').value || 'Ù¾Ø±ÙˆÚ˜Ù‡ Ø®Ø±Ù¾Ø§ Ùˆ ØªÛŒØ±Ú†Ù‡';
  
  // ØªØ§Ø±ÛŒØ®
  const now = new Date();
  const persianDate = now.toLocaleDateString('fa-IR');
  
  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¬Ù…Ø¹ Ú©Ù„ Ùˆ Ø³Ø§Ø®Øª Ù…ØªÙ† Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§
  let grandTotal = 0;
  let itemsText = '';
  
  rows.forEach((row, index) => {
    const cells = row.querySelectorAll("td");
    const desc = cells[1]?.innerText.split('\n')[0] || ''; // ÙÙ‚Ø· Ø®Ø· Ø§ÙˆÙ„
    const length = cells[2]?.textContent || '0';
    const quantity = cells[3]?.textContent || '0';
    const totalLength = cells[4]?.textContent || '0';
    const unitPrice = cells[5]?.textContent || '0';
    const totalPrice = cells[6]?.textContent || '0';
    
    const totalPriceNumber = parseInt(totalPrice.replace(/[Ù¬,]/g, '').replace(/[Û°-Û¹]/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'.indexOf(d))) || 0;
    grandTotal += totalPriceNumber;
    
    itemsText += `${index + 1}. ${desc}\n`;
    itemsText += `   ğŸ“ Ø·ÙˆÙ„: ${length} Ù…ØªØ± Ã— ${quantity} Ø¹Ø¯Ø¯ = ${totalLength} Ù…ØªØ±\n`;
    itemsText += `   ğŸ’° Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯: ${unitPrice} ØªÙˆÙ…Ø§Ù†\n`;
    itemsText += `   ğŸ§¾ Ø¬Ù…Ø¹ Ø±Ø¯ÛŒÙ: ${totalPrice} ØªÙˆÙ…Ø§Ù†\n\n`;
  });
  
  // Ø§ÛŒØ¬Ø§Ø¯ Ù…ØªÙ† Ù¾ÛŒØ§Ù…
  const message = 
`ğŸ“‹ *Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ± ØªÙˆÙ„ÛŒØ¯ÛŒ Ø®Ø±Ù¾Ø§ Ùˆ ØªÛŒØ±Ú†Ù‡ Ø³Ù…Ø§ÙˆÛŒ*

ğŸ“… ØªØ§Ø±ÛŒØ®: ${persianDate}
ğŸ”– Ø´Ù…Ø§Ø±Ù‡: PF-${Date.now().toString().slice(-6)}

ğŸ‘¤ *Ù…Ø´ØªØ±ÛŒ:* ${clientName}
ğŸ“ ØªÙ„ÙÙ†: ${clientPhone}
ğŸ“ Ø¢Ø¯Ø±Ø³: ${clientAddress}
ğŸ—ï¸ Ù¾Ø±ÙˆÚ˜Ù‡: ${projectName}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š *Ø§Ù‚Ù„Ø§Ù… Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ±:*

${itemsText}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’° *Ø¬Ù…Ø¹ Ú©Ù„: ${grandTotal.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†*
ğŸ“ *Ø­Ø±ÙˆÙÛŒ:* ${numberToWords(grandTotal)}

ğŸ“ ØªÙ…Ø§Ø³: Û°Û¹Û°Û°ÛµÛµÛµÛ³Û±Û±Û³
ğŸ¢ Ø¢Ø¯Ø±Ø³: Ø¨Ù†Ø¯Ø±Ø¹Ø¨Ø§Ø³ Ø¨Ù„ÙˆØ§Ø± Ø§Ù…Ø§Ù… Ø®Ù…ÛŒÙ†ÛŒ-Ø´Ù‡Ø± Ù†Ù…Ø§ÛŒØ´-Ù…Ø¬ØªÙ…Ø¹ Ø¨Ø²Ø±Ú¯ Ø´Ù‡Ø± Ù†Ù…Ø§ÛŒØ´-Ø·Ø¨Ù‚Ù‡ Ø§ÙˆÙ„-ÙˆØ§Ø­Ø¯ Ø´Ù…Ø§Ø±Ù‡ Û±Û±

âš ï¸ *Ø´Ø±Ø§ÛŒØ· Ùˆ Ø¶ÙˆØ§Ø¨Ø·:*
â€¢ ÙˆØ§Ø­Ø¯ Ù‚ÛŒÙ…Øª ØªÙˆÙ…Ø§Ù† Ù…ÛŒØ¨Ø§Ø´Ø¯
â€¢ Ù…Ø³Ø¦ÙˆÙ„ÛŒØª Ø¨Ø±Ø±Ø³ÛŒ Ùˆ Ø§Ù†Ø·Ø¨Ø§Ù‚ Ø·ÙˆÙ„ Ùˆ ØªØ¹Ø¯Ø§Ø¯ Ùˆ Ù…Ø´Ø®ØµØ§Øª Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ± Ø¨Ø§ Ù†Ù‚Ø´Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø²Ù‡ Ø¨Ø± Ø¹Ù‡Ø¯Ù‡ Ø®Ø±ÛŒØ¯Ø§Ø± Ù…ÛŒØ¨Ø§Ø´Ø¯
â€¢ ÙØ±ÙˆØ´Ù†Ø¯Ù‡ Ù…Ù„Ø²Ù… Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯ Ú†Ù†Ø§Ù†Ú†Ù‡ ØªÛŒØ±Ú†Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ­ÙˆÛŒÙ„ÛŒ Ù…ØºØ§ÛŒØ±Øª Ø¨Ø§ Ù…Ø´Ø®ØµØ§Øª ÙØ§Ú©ØªÙˆØ± Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ Ù†Ø³Ø¨Øª Ø¨Ù‡ Ø¹ÙˆØ¯Øª Ø¢Ù† Ù…Ø³Ø¤ÙˆÙ„ Ø¨Ø§Ø´Ø¯
â€¢ Ø§Ø¹ØªØ¨Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ±: Û²Û´ Ø³Ø§Ø¹Øª`;
  
  // Ø´Ù…Ø§Ø±Ù‡ ÙˆØ§ØªØ³Ø§Ù¾ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±
  const whatsappNumber = "989005553113";
  
  // Ú©Ø¯Ú¯Ø°Ø§Ø±ÛŒ Ù…ØªÙ† Ø¨Ø±Ø§ÛŒ URL
  const encodedMessage = encodeURIComponent(message);
  
  // Ø§ÛŒØ¬Ø§Ø¯ Ù„ÛŒÙ†Ú© ÙˆØ§ØªØ³Ø§Ù¾
  const whatsappURL = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
  
  // Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù„ÛŒÙ†Ú© Ø¯Ø± Ù¾Ù†Ø¬Ø±Ù‡ Ø¬Ø¯ÛŒØ¯
  window.open(whatsappURL, '_blank');
  
  // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… ØªØ£ÛŒÛŒØ¯
  alert("Ù¾Ù†Ø¬Ø±Ù‡ ÙˆØ§ØªØ³Ø§Ù¾ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø² Ø´Ø¯Ù† Ø§Ø³Øª...\n\nÙ„Ø·ÙØ§Ù‹ Ù¾ÛŒØ§Ù… Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø±Ø¯Ù‡ Ùˆ Ø¯Ú©Ù…Ù‡ Ø§Ø±Ø³Ø§Ù„ Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯.");
}

// Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
document.addEventListener("DOMContentLoaded", function() {
  populateHeights();
  previewEl.innerHTML = "Ø§Ø¨ØªØ¯Ø§ Ù…Ø´Ø®ØµØ§Øª Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ØŒ Ø³Ù¾Ø³ Ø¯Ú©Ù…Ù‡ Â«Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ù‡Ø± Ù…ØªØ±Â» Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯.";
  
  // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ selectÙ‡Ø§
  heightSel.addEventListener("change", ()=>{
    populateZigs();
    bottomSel.innerHTML = "<option value=''>â€”</option>";
    topSel.innerHTML = "<option value=''>â€”</option>";
  });
  
  zigSel.addEventListener("change", ()=>{
    populateBottoms();
  });
  
  bottomSel.addEventListener("change", ()=>{
    populateTops();
  });
  
  // Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
  document.getElementById("calcBtn").addEventListener("click", calcPrice);
  document.getElementById("addToQuote").addEventListener("click", addToQuote);
  document.getElementById("clearQuote").addEventListener("click", clearQuote);
  document.getElementById("exportImage").addEventListener("click", exportToImage);
  document.getElementById("sendWhatsapp").addEventListener("click", sendInvoiceViaWhatsapp);
  
  // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±
  openAdminBtn.addEventListener("click", ()=>{
    adminBg.style.display = "flex";
    setAdminReadonly(true);
    fillAdminFields(false);
    adminPassInput.value = "";
    clearAdminStatus();
  });

  closeAdminBtn.addEventListener("click", ()=>{
    adminBg.style.display = "none";
  });

  unlockBtn.addEventListener("click", ()=>{
    if (adminPassInput.value === getAdminPassword()) {
      setAdminReadonly(false);
      fillAdminFields(true);
      showAdminStatus("Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø¯ÛŒØ± ÙØ¹Ø§Ù„ Ø´Ø¯. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù…Ù‚Ø§Ø¯ÛŒØ± Ø±Ø§ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù†ÛŒØ¯.", "success");
    } else {
      showAdminStatus("Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù†Ø§Ø¯Ø±Ø³Øª Ø§Ø³Øª.", "error");
    }
  });

  adminSaveBtn.addEventListener("click", ()=>{
    if (!ironInput.readOnly) {
      const newIron = Number(ironInput.value) || DEFAULT_CONFIG.ironPrice;
      const newConc = Number(concreteInput.value) || DEFAULT_CONFIG.concretePrice;
      const nr8  = Number(r8Input.value)  || DEFAULT_CONFIG.rebar[8];
      const nr10 = Number(r10Input.value) || DEFAULT_CONFIG.rebar[10];
      const nr12 = Number(r12Input.value) || DEFAULT_CONFIG.rebar[12];
      const nr14 = Number(r14Input.value) || DEFAULT_CONFIG.rebar[14];
      const nr16 = Number(r16Input.value) || DEFAULT_CONFIG.rebar[16];
      const nr18 = Number(r18Input.value) || DEFAULT_CONFIG.rebar[18];

      config.ironPrice = newIron;
      config.concretePrice = newConc;
      config.rebar[8]  = nr8;
      config.rebar[10] = nr10;
      config.rebar[12] = nr12;
      config.rebar[14] = nr14;
      config.rebar[16] = nr16;
      config.rebar[18] = nr18;

      if (saveConfig(config)) {
        showAdminStatus("ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.", "success");
      } else {
        showAdminStatus("Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª.", "error");
      }
    }
    setTimeout(() => {
      adminBg.style.display = "none";
    }, 1500);
  });

  adminResetBtn.addEventListener("click", ()=>{
    if (confirm("Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ØªÙ…Ø§Ù… ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ù‡ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´ÙˆÙ†Ø¯ØŸ")) {
      config = structuredClone(DEFAULT_CONFIG);
      saveConfig(config);
      fillAdminFields(true);
      showAdminStatus("ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ù‡ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´Ø¯.", "success");
    }
  });
});
</script>
</body>

</html>


